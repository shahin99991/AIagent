# AI Agent テスト手順書

このドキュメントでは、AI Agentアプリケーションのテスト手順について説明します。

## 目次
1. [環境設定](#環境設定)
2. [ユニットテスト](#ユニットテスト)
3. [統合テスト](#統合テスト)
4. [エンドツーエンドテスト](#エンドツーエンドテスト)
5. [パフォーマンステスト](#パフォーマンステスト)

## 環境設定

### 前提条件
- Python 3.11以上
- pip（Pythonパッケージマネージャー）
- Google Cloud Platformアカウントとプロジェクト
- Gemini APIの有効化と認証情報

### テスト環境のセットアップ
1. リポジトリのクローン
```bash
git clone https://github.com/shahin99991/AIagent.git
cd AIagent
```

2. 仮想環境の作成と有効化
```bash
python -m venv venv
source venv/bin/activate  # Unix/macOS
# または
.\venv\Scripts\activate  # Windows
```

3. 依存関係のインストール
```bash
pip install -r requirements.txt
pip install pytest pytest-cov  # テストツールのインストール
```

4. 環境変数の設定
```bash
cp .env.example .env
# .envファイルを編集し、必要な認証情報を設定
```

## ユニットテスト

### Gemini Serviceのテスト
```bash
pytest tests/test_gemini_service.py -v
```

テスト項目：
- テキスト生成機能
- マルチモーダル処理
- エラーハンドリング
- 安全性チェック機能

### Flaskアプリケーションのテスト
```bash
pytest tests/test_app.py -v
```

テスト項目：
- ルーティング
- リクエスト処理
- レスポンス形式
- エラーハンドリング

## 統合テスト

### APIエンドポイントのテスト
```bash
pytest tests/test_integration.py -v
```

テスト項目：
1. チャットエンドポイント（/chat）
   - テキストメッセージの送受信
   - 長文メッセージの処理
   - 特殊文字の処理

2. マルチモーダルエンドポイント（/multimodal_chat）
   - 画像とテキストの組み合わせ処理
   - 様々な画像フォーマットの処理
   - 大きいサイズの画像の処理

3. ヘルスチェックエンドポイント（/health）
   - 応答の確認
   - ステータスコードの検証

## エンドツーエンドテスト

### UIテスト
```bash
pytest tests/test_ui.py -v
```

テスト項目：
1. チャットインターフェース
   - メッセージの送信と表示
   - 画像のアップロード機能
   - レスポンシブデザインの確認

2. エラー表示
   - ネットワークエラー時の表示
   - APIエラー時の表示
   - 入力バリデーション

3. UI機能
   - テーマ切り替え
   - マークダウン表示
   - コードハイライト

## パフォーマンステスト

### 負荷テスト
```bash
pytest tests/test_performance.py -v
```

テスト項目：
1. 同時接続処理
   - 複数ユーザーの同時アクセス
   - メッセージの同時送信
   - レスポンス時間の測定

2. リソース使用量
   - メモリ使用量の監視
   - CPU使用率の確認
   - ネットワーク帯域の使用状況

### セキュリティテスト
```bash
pytest tests/test_security.py -v
```

テスト項目：
1. 入力検証
   - XSS対策
   - SQLインジェクション対策
   - ファイルアップロードの制限

2. API セキュリティ
   - レート制限
   - 認証処理
   - エラーメッセージの適切な表示

## テストカバレッジの確認

すべてのテストを実行し、カバレッジレポートを生成：
```bash
pytest --cov=src tests/ --cov-report=html
```

カバレッジレポートは `htmlcov/index.html` で確認できます。

## 継続的インテグレーション

GitHubアクションを使用して、以下のタイミングでテストを自動実行：
- プルリクエスト作成時
- mainブランチへのプッシュ時
- 定期的な実行（毎日深夜）

## トラブルシューティング

### よくある問題と解決方法
1. テスト実行時のタイムアウト
   - タイムアウト値の調整
   - ネットワーク接続の確認

2. 環境変数関連のエラー
   - .envファイルの存在確認
   - 必要な認証情報の設定確認

3. 依存関係のエラー
   - requirements.txtの最新化
   - 仮想環境の再作成

## 注意事項
- テスト実行時はテスト用のGCP認証情報を使用すること
- 実際のAPIキーやシークレットをテストコードにハードコードしないこと
- 大量のリクエストを発生させるテストは本番環境で実行しないこと 